{% extends 'base.html' %}
{% load static i18n l10n react_maps_tags %}
{% block extra_js %}
    {{ block.super }}
    <script src="{% static 'wine_carousel.js' %}" type="module" defer></script>
    <script src="{% static 'maps.js' %}"></script>
{% endblock extra_js %}
{% block styles %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'maps.css' %}" />
{% endblock styles %}
{% block header %}
    <h1 class="header__title">{{ wine.name }}</h1>
{% endblock header %}
{% block content %}
    <div class="wine-detail__container">
        <div class="pure-g">
            <div class="pure-u-1 pure-u-md-1">
                {% url 'wine-edit' wine.pk as edit_url %}
                {% url 'wine-delete' wine.pk as delete_url %}
                {% include "includes/edit_delete_buttons.html" with edit_url=edit_url delete_url=delete_url %}
            </div>
            <div class="pure-u-1 pure-u-md-1-2">
                {% if wine.image_thumbnail %}
                    <div class="wine-detail__image-wrapper"
                         data-images='[{% for img in wine.image_thumbnails %}"{{ img }}"{% if not forloop.last %},{% endif %}{% endfor %}]'>
                        <div class="image wine-detail__image" id="wine-image-wrapper">
                            <img id="wine-image"
                                 src="{{ wine.image_thumbnail }}"
                                 height="225"
                                 width="auto"
                                 alt="{% translate 'Picture of a wine bottle' %}">
                        </div>
                        {% if wine.image_thumbnails|length > 1 %}
                            <div class="image-controls"
                                 role="group"
                                 aria-label="{% translate "Image carousel controls" %}">
                                <button type="button"
                                        class="wine-prev"
                                        aria-label="{% translate "Previous image" %}"
                                        title="{% translate "Previous image" %}">«</button>
                                <button type="button"
                                        class="wine-next"
                                        aria-label="{% translate "Next image" %}"
                                        title="{% translate "Next image" %}">»</button>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <div>{% translate "No image" %}</div>
                {% endif %}
            </div>
            <div class="pure-u-1 pure-u-md-1-2">
                <table class="wine-detail__table">
                    <tr>
                        <th>{% translate "Country" context "Singular" %}</th>
                        <td>{{ wine.country_icon }} {{ wine.country_name }}</td>
                    </tr>
                    {% if wine.get_vineyards %}
                        <tr>
                            <th>{% translate "Vineyard" %}</th>
                            <td>{{ wine.get_vineyards | linebreaksbr }}</td>
                        </tr>
                    {% endif %}
                    <tr>
                        <th>{% translate "Type" %}</th>
                        <td>{{ wine.get_type }}</td>
                    </tr>
                    {% if wine.get_attributes %}
                        <tr>
                            <th>{% translate "Attributes" %}</th>
                            <td>{{ wine.get_attributes | linebreaksbr }}</td>
                        </tr>
                    {% endif %}
                    <tr>
                        <th>{% translate "Category" %}</th>
                        <td>{{ wine.get_category }}</td>
                    </tr>
                    <tr>
                        <th>{% translate "ABV" %}</th>
                        <td>{{ wine.abv | localize }}</td>
                    </tr>
                    <tr>
                        <th>{% translate "Size" %}</th>
                        <td>{{ wine.size }}</td>
                    </tr>
                    <tr>
                        <th>{% translate "Vintage" %}</th>
                        <td>{{ wine.vintage }}</td>
                    </tr>
                    <tr>
                        <th>{% translate "Drink By" %}</th>
                        <td>{{ wine.drink_by }}</td>
                    </tr>
                    <tr>
                        <th>{% translate "Grapes" %}</th>
                        <td>{{ wine.get_grapes | linebreaksbr }}</td>
                    </tr>
                    {% if wine.get_sources %}
                        <tr>
                            <th>{% translate "Sources" %}</th>
                            <td>{{ wine.get_sources | linebreaksbr }}</td>
                        </tr>
                    {% endif %}
                    {% if wine.get_food_pairings %}
                        <tr>
                            <th>{% translate "Food Pairings" %}</th>
                            <td>{{ wine.get_food_pairings | linebreaksbr }}</td>
                        </tr>
                    {% endif %}
                    {% if wine.price is not None or wine.get_average_price_with_currency %}
                        <tr>
                            <th>{% translate "Price" %}</th>
                            <td>{{ wine.get_price_with_currency }}{% if wine.get_average_price_with_currency %} ({% translate "Average" %}: {{ wine.get_average_price_with_currency }}){% endif %}</td>
                        </tr>
                    {% endif %}
                    {% if wine.comment %}
                        <tr>
                            <th>{% translate "Comment" %}</th>
                            <td>{{ wine.comment }}</td>
                        </tr>
                    {% endif %}
                    <tr>
                        <th>{% translate "Rating" %}</th>
                        <td>
                            {% if wine.rating %}
                                {{ wine.rating }} / 10
                            {% else %}
                                {% translate "No rating yet" %}
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
            {% if wine.location %}
            <div class="pure-u-1 pure-u-md-2-3 m-auto wine-detail__map">{% react_detail_map wine %}</div>
            {% endif %}
            <div class="pure-u-1 pure-u-md-1 text-align-center">
                <h2 class="header__title">{% translate "Stock" %}</h2>
            </div>
            <div class="pure-u-1 pure-u-md-3-8 m-auto">
                <div class="d-flex j-between mb-12">
                    <p class="stock__count">
                        {% blocktranslate count counter=wine.total_stock %}
                    {{ counter }} bottle
                    {% plural %}
                    {{ counter }} bottles
                    {% endblocktranslate %}
                    </p>
                    <a href="{% url 'stock-add' wine.pk %}"
                       class="pure-button button__neutral"><i class="fa-regular fa-plus"></i> <span>{% translate "Add bottle" %}</span></a>
                </div>
                <div class="pure-u-1 pure-u-md-1">
                    {% if wine.get_stock %}
                        <table class="pure-table pure-table-horizontal pure-table-striped wine-detail__stock-table">
                            <thead>
                                <tr>
                                    <th>{% translate "Location" %}</th>
                                    <th>{% translate "Row" %}</th>
                                    <th>{% translate "Cell" %}</th>
                                    <th></th>
                                </tr>
                            </thead>
                            {% for item in wine.get_stock %}
                                <tr>
                                    <td>{{ item.storage }}</td>
                                    <td>{{ item.row|default_if_none:"" }}</td>
                                    <td>{{ item.column|default_if_none:"" }}</td>
                                    <td>
                                        <a class=" pure-button" href="{% url 'stock-delete' item.pk %}"><i class="fa-regular fa-trash-can"></i></a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </table>
                    {% else %}
                        <p>{% translate "No bottles in stock." %}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
